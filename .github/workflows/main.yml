on: 
  push:
    branches:
    - main
  pull_request:
    branches: 
    - main
  workflow_dispatch:

jobs:
  speak:
    name: Speaking
    runs-on: ubuntu-latest
    steps:
      - name: Speak
        run: echo "Hello world"

  test:
    name: Testing charn-lmnh-plant
    runs-on: ubuntu-latest
    steps:
      - name: Get repo
        uses: actions/checkout@v4

      - name: Install Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.14" 

      - name: Install libraries
        run: pip install -r requirements.txt

      - name: Run pytest
        run: pytest
        env:
          DATABASE_NAME: ${{ secrets.DATABASE_NAME }}
          DATABASE_USERNAME: ${{ secrets.DATABASE_USERNAME }}
          DATABASE_PASSWORD: ${{ secrets.DATABASE_PASSWORD }}
          DATABASE_IP: ${{ secrets.DATABASE_IP }}
          DATABASE_PORT: ${{ secrets.DATABASE_PORT }}

      - name: Run pylint
        run: pylint project directory --fail-under=8

  deploy:
    needs: test 
    name: Deploy
    runs-on: ubuntu-latest
    steps:
      - name: Get repo
        uses: actions/checkout@v4

      - name: Deploy charn-lmnh-plant
        uses: easingthemes/ssh-deploy@main
        with:
          SSH_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}
          SOURCE: ${{ secrets.<SOURCE_SECRET> }}          
          REMOTE_HOST: ${{ secrets.<REMOTE_HOST_SECRET> }}# e.g. "REMOTE_HOST"
          REMOTE_USER: ${{ secrets.<REMOTE_USER_SECRET> }}# e.g. "REMOTE_USER"
          TARGET: ${{ secrets.<REMOTE_TARGET_SECRET> }}

          SCRIPT_BEFORE: |
            whoami
            ls -al

          SCRIPT_AFTER: |
            whoami
            ls -al
            echo "$RSYNC_STDOUT"